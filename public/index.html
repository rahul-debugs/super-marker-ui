

<!-- updated for the add and delet -->
 <!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuperMart Dashboard</title>
  <link rel="stylesheet" href="indexstyle.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar">
    <div class="navbar-brand">SuperMart</div>
    <div class="navbar-links">
        <a href="#" class="active">Home</a>
        <a href="#products">Products</a>
        <a href="#dashboard">Dashboard</a>
        <a href="login.html">Admin</a>
        <a href="login.html" class="logout-btn">Logout</a>
    </div>
</nav>

<div class="main-content">
    <section id="dashboard" class="dashboard-section">
        <h2>Business Overview</h2>
        <div class="stats-grid">
            <div class="stat-card total-sales">
                <p class="stat-title">Total Sales (Today)</p>
                <p class="stat-value">$1,250.00</p>
                <p class="stat-change positive">+8.5%</p>
            </div>
            <div class="stat-card profit">
                <p class="stat-title">Net Profit</p>
                <p class="stat-value">$320.50</p>
                <p class="stat-change positive">+12.1%</p>
            </div>
            <div class="stat-card new-orders">
                <p class="stat-title">New Orders</p>
                <p class="stat-value">45</p>
                <p class="stat-change negative">-2.0%</p>
            </div>
            <div class="stat-card stock-level">
                <p class="stat-title">Low Stock Items</p>
                <p class="stat-value">12</p>
                <p class="stat-change warning">Action Required</p>
            </div>
        </div>
    </section>

    <section id="products" class="products-section">
        <h2>Our Products</h2>
        <div class="product-grid" id="productGrid"></div>
    </section>

    <section id="cart" class="cart-section">
        <h2>Shopping Cart</h2>
        <ul id="cart-list">
            <li id="empty-cart-message">Your cart is empty.</li>
        </ul>
        <p class="cart-total">Total: <span id="cart-total-value">$0.00</span></p>
        <button id="checkout-btn">Checkout</button>
    </section>
</div>

<script>
const cart = [];
const cartList = document.getElementById('cart-list');
const cartTotalValue = document.getElementById('cart-total-value');
const checkoutBtn = document.getElementById('checkout-btn');
const productGrid = document.getElementById("productGrid");

// Load products
function loadProducts() {
    const products = JSON.parse(localStorage.getItem("products")) || [];
    productGrid.innerHTML = "";

    products.forEach((p) => {
        const card = document.createElement("div");
        card.classList.add("product-card");
        card.dataset.price = p.price;
        card.innerHTML = `
            <div class="product-logo">${p.logo}</div>
            <div class="product-details">
                <h3 class="product-name">${p.name}</h3>
                <p class="product-price">$${p.price.toFixed(2)} / ${p.unit}</p>
                <button class="add-to-cart-btn">Add to Cart</button>
            </div>
        `;
        productGrid.appendChild(card);
    });

    attachCartEvents();
}

// Add to cart
function attachCartEvents() {
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', (e) => {
            const card = e.target.closest('.product-card');
            const name = card.querySelector('.product-name').textContent;
            const price = parseFloat(card.dataset.price);

            // Check if item already exists, increase quantity if so
            const existingItem = cart.find(item => item.name === name);
            if(existingItem){
                existingItem.quantity += 1;
            } else {
                cart.push({ name, price, quantity: 1 });
            }
            renderCart();
        });
    });
}

// Render cart
function renderCart() {
    cartList.innerHTML = '';
    let total = 0;

    if(cart.length === 0){
        cartList.innerHTML = '<li id="empty-cart-message">Your cart is empty.</li>';
    } else {
        cart.forEach(item => {
            const li = document.createElement('li');
            li.textContent = `${item.name} x${item.quantity} - $${(item.price*item.quantity).toFixed(2)}`;
            cartList.appendChild(li);
            total += item.price * item.quantity;
        });
    }

    cartTotalValue.textContent = `$${total.toFixed(2)}`;
}

// Checkout
checkoutBtn.addEventListener('click', async () => {
    if(cart.length === 0){
        alert("Your cart is empty!");
        return;
    }

    try {
        const response = await fetch("/add-to-cart", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ items: cart })
        });

        const data = await response.json();
        if(response.ok){
            alert(data.message);
            cart.length = 0;
            renderCart();
        } else {
            alert("Error: " + data.message);
        }
    } catch (err) {
        alert("Error storing cart: " + err.message);
    }
});

// Initial load
loadProducts();
</script>

</body>
</html> -->

<!-- updated ui and dashboard -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuperMart Dashboard</title>
  <link rel="stylesheet" href="indexstyle.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="container nav-container">
    <div class="navbar-brand">üõí SuperMart</div>
    <div class="navbar-links">
      <a href="#" class="active">Home</a>
      <a href="#products">Products</a>
      <a href="#dashboard">Dashboard</a>
      <a href="login.html">Admin</a>
      <a href="login.html" class="logout-btn">Logout</a>
    </div>
  </div>
</nav>

<div class="main-content container">

  <!-- Dashboard -->
  <section id="dashboard" class="dashboard-section">
    <h2 class="section-title">üìä Business Overview</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <h4>Total Sales (Today)</h4>
        <p class="stat-value" id="stat-sales">$0.00</p>
        <span class="stat-change positive" id="stat-sales-change">+0%</span>
      </div>
      <div class="stat-card">
        <h4>Net Profit</h4>
        <p class="stat-value" id="stat-profit">$0.00</p>
        <span class="stat-change positive" id="stat-profit-change">+0%</span>
      </div>
      <div class="stat-card">
        <h4>New Orders</h4>
        <p class="stat-value" id="stat-orders">0</p>
        <span class="stat-change neutral" id="stat-orders-change">0%</span>
      </div>
      <div class="stat-card">
        <h4>Low Stock Items</h4>
        <p class="stat-value" id="stat-low-stock">0</p>
        <span class="stat-change warning" id="stat-stock-warning">Normal</span>
      </div>
    </div>
  </section>

  <!-- Products -->
  <section id="products" class="products-section">
    <h2 class="section-title">üõç Our Products</h2>
    <div class="product-grid" id="productGrid"></div>
  </section>

  <!-- Cart -->
  <section id="cart" class="cart-section">
    <h2 class="section-title">üõí Shopping Cart</h2>
    <ul id="cart-list">
      <li id="empty-cart-message">Your cart is empty.</li>
    </ul>
    <div class="cart-summary">
      <p class="cart-total">Total: <span id="cart-total-value">$0.00</span></p>
      <button id="checkout-btn" class="btn-primary">Checkout</button>
    </div>
  </section>

</div>

<script>
const cart = [];
let totalSales = 0;
let totalProfit = 0;
let totalOrders = 0;

const cartList = document.getElementById('cart-list');
const cartTotalValue = document.getElementById('cart-total-value');
const checkoutBtn = document.getElementById('checkout-btn');
const productGrid = document.getElementById("productGrid");

// Dashboard elements
const statSales = document.getElementById("stat-sales");
const statProfit = document.getElementById("stat-profit");
const statOrders = document.getElementById("stat-orders");
const statLowStock = document.getElementById("stat-low-stock");
const statStockWarning = document.getElementById("stat-stock-warning");

// Load products
function loadProducts() {
  const defaultProducts = [
    { name: "Milk", price: 2.5, unit: "ltr", stock: 6, logo: "ü•õ" },
    { name: "Bread", price: 1.2, unit: "loaf", stock: 8, logo: "üçû" },
    { name: "Apple", price: 0.5, unit: "pc", stock: 20, logo: "üçé" },
    { name: "Chicken", price: 5, unit: "kg", stock: 6, logo: "üçó" }
  ];
  const products = JSON.parse(localStorage.getItem("products")) || defaultProducts;

  localStorage.setItem("products", JSON.stringify(products));
  renderProducts(products);
  updateLowStock();
}

function renderProducts(products) {
  productGrid.innerHTML = "";
  products.forEach((p, index) => {
    const card = document.createElement("div");
    card.classList.add("product-card");
    card.dataset.price = p.price;
    card.dataset.index = index;
    card.dataset.stock = p.stock;
    card.innerHTML = `
      <div class="product-logo">${p.logo}</div>
      <div class="product-details">
        <h3 class="product-name">${p.name}</h3>
        <p class="product-price">$${p.price.toFixed(2)} / ${p.unit}</p>
        <p class="stock-label">Stock: <span class="stock-count">${p.stock}</span></p>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
    `;
    productGrid.appendChild(card);
  });
  attachCartEvents();
}

// Add to cart
function attachCartEvents() {
  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', (e) => {
      const card = e.target.closest('.product-card');
      const name = card.querySelector('.product-name').textContent;
      const price = parseFloat(card.dataset.price);
      const index = parseInt(card.dataset.index);
      let products = JSON.parse(localStorage.getItem("products"));
      let product = products[index];

      const existingItem = cart.find(item => item.name === name);
      let currentQuantity = existingItem ? existingItem.quantity : 0;

      if(currentQuantity >= product.stock){
        alert("Out of stock!");
        return;
      }

      if(existingItem){
        existingItem.quantity += 1;
      } else {
        cart.push({ name, price, quantity: 1 });
      }
      renderCart();
    });
  });
}

// Render cart
function renderCart() {
  cartList.innerHTML = '';
  let total = 0;

  if(cart.length === 0){
    cartList.innerHTML = '<li id="empty-cart-message">Your cart is empty.</li>';
  } else {
    cart.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} x${item.quantity} - $${(item.price*item.quantity).toFixed(2)}`;
      cartList.appendChild(li);
      total += item.price * item.quantity;
    });
  }
  cartTotalValue.textContent = `$${total.toFixed(2)}`;
}

// Checkout
checkoutBtn.addEventListener('click', async () => {
  if(cart.length === 0){
    alert("Your cart is empty!");
    return;
  }

  let total = 0;
  cart.forEach(item => total += item.price * item.quantity);

  try {
    // üî• Send order to backend (MongoDB)
    const response = await fetch("/add-to-cart", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ items: cart, total })
    });

    const data = await response.json();
    if(response.ok){
      // ‚úÖ Update Dashboard after successful DB save
      totalSales += total;
      totalProfit += total * 0.25; 
      totalOrders += 1;

      statSales.textContent = `$${totalSales.toFixed(2)}`;
      statProfit.textContent = `$${totalProfit.toFixed(2)}`;
      statOrders.textContent = totalOrders;

      updateLowStock();

      alert(data.message);
      cart.length = 0;
      renderCart();
    } else {
      alert("Error: " + data.message);
    }
  } catch (err) {
    alert("Error storing cart: " + err.message);
  }
});

// Update low stock
function updateLowStock() {
  let products = JSON.parse(localStorage.getItem("products"));
  let lowStockCount = products.filter(p => p.stock <= 5).length;
  statLowStock.textContent = lowStockCount;
  statStockWarning.textContent = lowStockCount > 0 ? "‚ö† Action Required" : "Normal";
}

// Initial load
loadProducts();
</script>





</body>
</html>
